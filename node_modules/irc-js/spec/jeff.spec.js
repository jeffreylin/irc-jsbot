
var fs = require( 'fs' )
  , path = require( 'path' )
  , Compiler
  , messages

require.paths.unshift( path.join( __dirname, '..', 'node_modules' ) )
require.paths.unshift( path.join( __dirname, '..', 'lib' ) )

Compiler = require( path.join( __dirname, '..', 'lib', 'compiler' ) )

require('repl').start();
/*
var input = ':iffy|mbp!~iffy|mbp@Rizon-F0D48143.hsd1.ca.comcast.net NICK :asldkfjskadlf\r\n';
var output = Compiler.compile(input);
console.log(output);
//*/
























return;

/* ------------------------------ Fixtures ------------------------------ */
messages = JSON.parse( fs.readFileSync( path.join( __dirname, 'messages.json' ) ).toString() )

/* ------------------------------ Tests ------------------------------ */
exports[ 'Can parse Freenode cloaks' ] = function( test ) { var m
  m = Compiler.compile( ':frigg!~eir@freenode/utility-bot/frigg PRIVMSG protobot :VERSION\r\n' )
  test.equal( 'freenode/utility-bot/frigg', m.person.host )
  test.finish()
}


/* ------------------------------ Only Test Successful Compilation ------------------------------ */
messages.forEach( function( message, idx ) {
  exports[ 'Message compilation #' + idx + ': "' + message.slice( 0, -2 ) + '"' ] = function( test ) {
    test.ok( Compiler.compile( message ) )
    test.finish()
  }
})

/* ------------------------------ Run ------------------------------ */
if ( module == require.main )
  require( 'async_testing' ).run( __filename, process.ARGV )

